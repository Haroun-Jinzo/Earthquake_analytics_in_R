{
  "hash": "e36ecfda6ca508a2e175f9175257ae28",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Correlation Analysis\"\nauthor: \"Your Name\"\ndate: today\nformat:\n  html:\n    code-fold: false\n    toc: true\n---\n\n# Introduction\n\nNow let's look at relationships between variables!\n\n## Load Libraries\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'tidyverse' was built under R version 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'ggplot2' was built under R version 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'tibble' was built under R version 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'tidyr' was built under R version 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'readr' was built under R version 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'purrr' was built under R version 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'dplyr' was built under R version 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'stringr' was built under R version 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'forcats' was built under R version 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'lubridate' was built under R version 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.1     ✔ stringr   1.6.0\n✔ ggplot2   4.0.0     ✔ tibble    3.3.0\n✔ lubridate 1.9.4     ✔ tidyr     1.3.1\n✔ purrr     1.2.0     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(corrplot)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'corrplot' was built under R version 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\ncorrplot 0.95 loaded\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(knitr)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'knitr' was built under R version 4.5.2\n```\n\n\n:::\n:::\n\n\n## Load Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nearthquake <- readRDS(\"../data/processed/earthquake_clean.rds\")\n```\n:::\n\n\n# Correlation Matrix\n\n## Calculate Correlations\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Select numeric columns\nnumeric_data <- earthquake %>%\n  select(Magnitude, Distance_km, Intensity, Epicenter_Lat, Epicenter_Lon) %>%\n  na.omit()\n\n# Calculate correlation matrix\ncor_matrix <- cor(numeric_data)\n\n# Show as table\ncor_matrix %>%\n  round(3) %>%\n  kable()\n```\n\n::: {.cell-output-display}\n\n\n|              | Magnitude| Distance_km| Intensity| Epicenter_Lat| Epicenter_Lon|\n|:-------------|---------:|-----------:|---------:|-------------:|-------------:|\n|Magnitude     |     1.000|      -0.216|    -0.062|        -0.141|        -0.889|\n|Distance_km   |    -0.216|       1.000|    -0.053|         0.129|         0.202|\n|Intensity     |    -0.062|      -0.053|     1.000|         0.078|         0.057|\n|Epicenter_Lat |    -0.141|       0.129|     0.078|         1.000|         0.145|\n|Epicenter_Lon |    -0.889|       0.202|     0.057|         0.145|         1.000|\n\n\n:::\n:::\n\n\n## Visualize Correlation Matrix\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncorrplot(cor_matrix,\n         method = \"circle\",\n         type = \"upper\",\n         tl.col = \"black\",\n         addCoef.col = \"black\",\n         title = \"Correlation Matrix\")\n```\n\n::: {.cell-output-display}\n![](04-correlations_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n**How to read:** \n- Red = positive correlation\n- Blue = negative correlation\n- Bigger circles = stronger relationship\n\n# Key Relationships\n\n## Magnitude vs Distance\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(earthquake, aes(x = Distance_km, y = Magnitude)) +\n  geom_point(alpha = 0.5, color = \"darkblue\") +\n  geom_smooth(method = \"lm\", color = \"red\") +\n  labs(\n    title = \"Magnitude vs Distance from Epicenter\",\n    x = \"Distance (km)\",\n    y = \"Magnitude\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 7892 rows containing non-finite outside the scale range\n(`stat_smooth()`).\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 7892 rows containing missing values or values outside the scale range\n(`geom_point()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](04-correlations_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Test correlation\ncor_test <- cor.test(earthquake$Magnitude, earthquake$Distance_km)\ncat(\"Correlation:\", round(cor_test$estimate, 3), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCorrelation: -0.214 \n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"P-value:\", format.pval(cor_test$p.value), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nP-value: < 2.22e-16 \n```\n\n\n:::\n:::\n\n\n**Interpretation:** Weak correlation - magnitude doesn't depend on where we measure it (expected!).\n\n## Magnitude vs Intensity\n\n\n::: {.cell}\n\n```{.r .cell-code}\nearthquake %>%\n  filter(!is.na(Intensity)) %>%\n  ggplot(aes(x = Magnitude, y = Intensity)) +\n  geom_point(alpha = 0.5, color = \"darkgreen\") +\n  geom_smooth(method = \"lm\", color = \"red\") +\n  labs(\n    title = \"Magnitude vs Intensity\",\n    x = \"Magnitude\",\n    y = \"Intensity\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 6463 rows containing non-finite outside the scale range\n(`stat_smooth()`).\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 6463 rows containing missing values or values outside the scale range\n(`geom_point()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](04-correlations_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Test correlation\nintensity_data <- earthquake %>% filter(!is.na(Intensity))\ncor_test2 <- cor.test(intensity_data$Magnitude, intensity_data$Intensity)\ncat(\"Correlation:\", round(cor_test2$estimate, 3), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCorrelation: -0.06 \n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"P-value:\", format.pval(cor_test2$p.value), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nP-value: < 2.22e-16 \n```\n\n\n:::\n:::\n\n\n**Interpretation:** Positive correlation - bigger earthquakes have higher intensity (makes sense!).\n\n## Distance vs Intensity\n\n\n::: {.cell}\n\n```{.r .cell-code}\nearthquake %>%\n  filter(!is.na(Intensity)) %>%\n  ggplot(aes(x = Distance_km, y = Intensity)) +\n  geom_point(alpha = 0.5, color = \"purple\") +\n  geom_smooth(method = \"lm\", color = \"red\") +\n  labs(\n    title = \"Distance vs Intensity\",\n    x = \"Distance (km)\",\n    y = \"Intensity\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 1412 rows containing non-finite outside the scale range\n(`stat_smooth()`).\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 1412 rows containing missing values or values outside the scale range\n(`geom_point()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](04-correlations_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Test correlation\ncor_test3 <- cor.test(intensity_data$Distance_km, intensity_data$Intensity)\ncat(\"Correlation:\", round(cor_test3$estimate, 3), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCorrelation: -0.049 \n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"P-value:\", format.pval(cor_test3$p.value), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nP-value: < 2.22e-16 \n```\n\n\n:::\n:::\n\n\n**Interpretation:** Negative correlation - intensity decreases with distance (expected!).\n\n# Summary Table\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntibble(\n  Relationship = c(\"Magnitude ↔ Distance\", \"Magnitude ↔ Intensity\", \"Distance ↔ Intensity\"),\n  Correlation = c(\n    round(cor(earthquake$Magnitude, earthquake$Distance_km, use = \"complete.obs\"), 3),\n    round(cor(intensity_data$Magnitude, intensity_data$Intensity, use = \"complete.obs\"), 3),\n    round(cor(intensity_data$Distance_km, intensity_data$Intensity, use = \"complete.obs\"), 3)\n  ),\n  Interpretation = c(\n    \"Weak - magnitude independent of distance\",\n    \"Positive - bigger earthquake = higher intensity\",\n    \"Negative - farther away = lower intensity\"\n  )\n) %>%\n  kable()\n```\n\n::: {.cell-output-display}\n\n\n|Relationship          | Correlation|Interpretation                                  |\n|:---------------------|-----------:|:-----------------------------------------------|\n|Magnitude ↔ Distance  |      -0.214|Weak - magnitude independent of distance        |\n|Magnitude ↔ Intensity |      -0.060|Positive - bigger earthquake = higher intensity |\n|Distance ↔ Intensity  |      -0.049|Negative - farther away = lower intensity       |\n\n\n:::\n:::\n\n\n**Next:** Go to [Correlation Analysis](06-visualizations.qmd) →\n\n# Conclusions\n\nThe correlation analysis confirms expected earthquake behavior:\n\n1. **Magnitude is consistent** across all stations (same earthquake)\n2. **Larger earthquakes** produce higher intensities at stations\n3. **Intensity decreases** as you move away from the epicenter\n\nAll relationships are statistically significant (p < 0.05)!\n\n---\n\n**Analysis complete!** ✓",
    "supporting": [
      "04-correlations_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}