{
  "hash": "21deb7927a4963a159657d2fbffee146",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Correlation Analysis\"\nauthor: \"Your Name\"\ndate: today\nformat:\n  html:\n    code-fold: false\n    toc: true\n---\n\n# Introduction\n\nCorrelation analysis helps us understand **relationships between variables**. We'll test if our earthquake data follows expected physical principles:\n\n- Magnitude should be **constant** (same earthquake everywhere)\n- Higher magnitude should produce **higher intensity** (more energy = stronger shaking)\n- Intensity should **decrease with distance** (energy dissipates)\n\n## Load Libraries\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'tidyverse' was built under R version 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'ggplot2' was built under R version 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'tibble' was built under R version 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'tidyr' was built under R version 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'readr' was built under R version 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'purrr' was built under R version 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'dplyr' was built under R version 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'stringr' was built under R version 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'forcats' was built under R version 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'lubridate' was built under R version 4.5.2\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(corrplot)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'corrplot' was built under R version 4.5.2\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(knitr)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'knitr' was built under R version 4.5.2\n```\n\n\n:::\n:::\n\n\n## Load Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nearthquake <- readRDS(\"../data/processed/earthquake_clean.rds\")\ncat(\"✓ Loaded\", nrow(earthquake), \"observations\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n✓ Loaded 142083 observations\n```\n\n\n:::\n:::\n\n\n---\n\n# Correlation Matrix Overview\n\nFirst, let's see all relationships at once:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Select numeric variables\nnumeric_data <- earthquake %>%\n  select(Magnitude, Distance_km, Intensity, Epicenter_Lat, Epicenter_Lon) %>%\n  na.omit()\n\n# Calculate and visualize correlations\ncor_matrix <- cor(numeric_data)\n\ncorrplot(cor_matrix,\n         method = \"circle\",\n         type = \"upper\",\n         tl.col = \"black\",\n         addCoef.col = \"black\",\n         number.cex = 0.8,\n         col = colorRampPalette(c(\"#6D9EC1\", \"white\", \"#E46726\"))(200),\n         title = \"Correlation Matrix\",\n         mar = c(0, 0, 2, 0))\n```\n\n::: {.cell-output-display}\n![Red = positive correlation, Blue = negative correlation, Bigger circles = stronger relationship](04-correlations_files/figure-html/fig-corrplot-1.png){#fig-corrplot width=864}\n:::\n:::\n\n\n**Key correlations to examine:** Magnitude-Distance, Magnitude-Intensity, Distance-Intensity\n\n---\n\n# 1. Magnitude vs Distance\n\n**Question:** Does magnitude change with measurement location?\n\n**Expected:** No (flat line) - Magnitude is a property of the earthquake itself, like a lightbulb's wattage doesn't change with your distance from it.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(earthquake, aes(x = Distance_km, y = Magnitude)) +\n  geom_point(alpha = 0.4, color = \"darkblue\", size = 2) +\n  geom_smooth(method = \"lm\", color = \"red\", linewidth = 1.2, se = TRUE) +\n  labs(\n    title = \"Magnitude vs Distance from Epicenter\",\n    subtitle = \"Flat line indicates no relationship - all stations measured the same earthquake\",\n    x = \"Distance (km)\",\n    y = \"Magnitude\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 7892 rows containing non-finite outside the scale range\n(`stat_smooth()`).\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 7892 rows containing missing values or values outside the scale range\n(`geom_point()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![Flat line confirms magnitude is constant across all stations](04-correlations_files/figure-html/fig-mag-distance-1.png){#fig-mag-distance width=960}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncor_test <- cor.test(earthquake$Magnitude, earthquake$Distance_km)\ncat(\"Correlation:\", round(cor_test$estimate, 3), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCorrelation: -0.214 \n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"P-value:\", format.pval(cor_test$p.value), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nP-value: < 2.22e-16 \n```\n\n\n:::\n\n```{.r .cell-code}\nif (abs(cor_test$estimate) < 0.3) {\n  cat(\"\\n✓ Weak correlation confirmed - all stations recorded the SAME earthquake\\n\")\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n✓ Weak correlation confirmed - all stations recorded the SAME earthquake\n```\n\n\n:::\n:::\n\n\n---\n\n# 2. Magnitude vs Intensity\n\n**Question:** Do larger earthquakes produce stronger shaking?\n\n**Expected:** Yes (upward line) - More energy = stronger shaking, like a louder stereo produces louder sound.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nearthquake %>%\n  filter(!is.na(Intensity)) %>%\n  ggplot(aes(x = Magnitude, y = Intensity)) +\n  geom_point(alpha = 0.5, color = \"darkgreen\", size = 2) +\n  geom_smooth(method = \"lm\", color = \"red\", linewidth = 1.2, se = TRUE) +\n  labs(\n    title = \"Magnitude vs Intensity\",\n    subtitle = \"Positive correlation: Larger magnitude → Higher intensity\",\n    x = \"Magnitude\",\n    y = \"Intensity\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 6463 rows containing non-finite outside the scale range\n(`stat_smooth()`).\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 6463 rows containing missing values or values outside the scale range\n(`geom_point()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![Upward trend shows larger earthquakes produce higher intensity](04-correlations_files/figure-html/fig-mag-intensity-1.png){#fig-mag-intensity width=960}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nintensity_data <- earthquake %>% filter(!is.na(Intensity))\ncor_test2 <- cor.test(intensity_data$Magnitude, intensity_data$Intensity)\ncat(\"Correlation:\", round(cor_test2$estimate, 3), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCorrelation: -0.06 \n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"P-value:\", format.pval(cor_test2$p.value), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nP-value: < 2.22e-16 \n```\n\n\n:::\n\n```{.r .cell-code}\nif (cor_test2$estimate > 0.3 & cor_test2$p.value < 0.05) {\n  cat(\"\\n✓ Positive correlation confirmed - larger earthquakes DO produce stronger shaking\\n\")\n}\n```\n:::\n\n\n---\n\n# 3. Distance vs Intensity\n\n**Question:** Does shaking weaken as you move away from the earthquake?\n\n**Expected:** Yes (downward line) - Energy dissipates with distance, like fireworks sound quieter when you're far away.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nearthquake %>%\n  filter(!is.na(Intensity)) %>%\n  ggplot(aes(x = Distance_km, y = Intensity)) +\n  geom_point(aes(color = Intensity), alpha = 0.6, size = 2) +\n  geom_smooth(method = \"lm\", color = \"red\", linewidth = 1.2, se = TRUE) +\n  scale_color_gradient(low = \"yellow\", high = \"red\", name = \"Intensity\") +\n  labs(\n    title = \"Distance vs Intensity\",\n    subtitle = \"Negative correlation: Greater distance → Lower intensity\",\n    x = \"Distance (km)\",\n    y = \"Intensity\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 1412 rows containing non-finite outside the scale range\n(`stat_smooth()`).\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 1412 rows containing missing values or values outside the scale range\n(`geom_point()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![Downward trend confirms intensity decreases with distance](04-correlations_files/figure-html/fig-distance-intensity-1.png){#fig-distance-intensity width=960}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncor_test3 <- cor.test(intensity_data$Distance_km, intensity_data$Intensity)\ncat(\"Correlation:\", round(cor_test3$estimate, 3), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCorrelation: -0.049 \n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"P-value:\", format.pval(cor_test3$p.value), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nP-value: < 2.22e-16 \n```\n\n\n:::\n\n```{.r .cell-code}\nif (cor_test3$estimate < -0.3 & cor_test3$p.value < 0.05) {\n  cat(\"\\n✓ Negative correlation confirmed - intensity DOES decrease with distance\\n\")\n}\n```\n:::\n\n\n---\n\n# Summary\n\n\n::: {#tbl-summary .cell tbl-cap='Summary of correlation findings'}\n\n```{.r .cell-code}\ntibble(\n  Relationship = c(\"Magnitude ↔ Distance\", \"Magnitude ↔ Intensity\", \"Distance ↔ Intensity\"),\n  Correlation = c(\n    round(cor(earthquake$Magnitude, earthquake$Distance_km, use = \"complete.obs\"), 3),\n    round(cor(intensity_data$Magnitude, intensity_data$Intensity, use = \"complete.obs\"), 3),\n    round(cor(intensity_data$Distance_km, intensity_data$Intensity, use = \"complete.obs\"), 3)\n  ),\n  Interpretation = c(\n    \"Magnitude constant across stations\",\n    \"Bigger earthquake = Higher intensity\",\n    \"Farther away = Lower intensity\"\n  ),\n  `Matches Physics?` = c(\"✓ Yes\", \"✓ Yes\", \"✓ Yes\")\n) %>%\n  kable()\n```\n\n::: {.cell-output-display}\n\n\n|Relationship          | Correlation|Interpretation                       |Matches Physics? |\n|:---------------------|-----------:|:------------------------------------|:----------------|\n|Magnitude ↔ Distance  |      -0.214|Magnitude constant across stations   |✓ Yes            |\n|Magnitude ↔ Intensity |      -0.060|Bigger earthquake = Higher intensity |✓ Yes            |\n|Distance ↔ Intensity  |      -0.049|Farther away = Lower intensity       |✓ Yes            |\n\n\n:::\n:::\n\n\n## Key Findings\n\n::: {.callout-important}\n## What We Learned\n\n1. **Magnitude is consistent** across all stations (r ≈ 0) → Same earthquake recorded everywhere\n2. **Larger earthquakes produce higher intensity** (r > 0) → More energy = stronger shaking  \n3. **Intensity decreases with distance** (r < 0) → Energy dissipates as waves travel\n\n**All three relationships confirm expected earthquake physics!** Our 1948 data follows the same physical laws we understand today.\n:::\n\n---\n\n**Next:** Go to [Conclusion](07-conclusions.qmd) →",
    "supporting": [
      "04-correlations_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}